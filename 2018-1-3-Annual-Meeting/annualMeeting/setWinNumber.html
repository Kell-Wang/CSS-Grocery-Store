
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>设置中奖人数</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    

    <link rel="stylesheet" type="text/css" href=" static/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href=" static/css/reset.css">
    <link rel="stylesheet" type="text/css" href=" static/css/global.css">
    <link rel="stylesheet" type="text/css" href=" static/css/commonality.css">
    <link rel="stylesheet" type="text/css" href=" static/css/barrage.css">

    <script type="text/javascript" src=" static/js/jquery.min.js"></script>
    <script type="text/javascript" src=" static/js/scrollreveal/scrollreveal.min.js"></script>
    <script type="text/javascript" src=" static/js/global-functions-new.js"></script>
    <script type="text/javascript" src=" static/js/barrage.js"></script>
    
    <script type="text/javascript">
        // 加载scrollReveal
        (function(){
            window.sr = ScrollReveal();
        }());
    </script>

    <style type="text/css">
        .wall { position: relative; }
        .container {
            margin-top:7em;
        }

        h1 {
            text-align:center; font-size:108px;
            margin-top:10%;
            letter-spacing:13px;
        }


        /* 左侧 */
        .side-left, .switch-btn {
            margin-top:28%;
        }
        .side-left > .num-btn {
            margin-top:20px;
            width:100%; height:72px;
            line-height:350%;
            font-size:24px; cursor:pointer;
            text-align:center;
        }
        .num-btn-default-bg {
            color: #c30f23;
            background: url(" static/img/side-button-bg-sm.png") no-repeat center;
        }
        .num-btn-bg-hover {
            color:#fff;
            background:url(" static/img/side-button-bg-sm-hover.png") no-repeat center;
        }



        /* 中间 */
        .awards-btn {
            display:block; overflow:hidden;
            font-size:50px;  color:#ffffff;
            text-shadow:0 2px 4px rgba(0,0,0,0.50);
            margin:0 auto; line-height:106px;
            text-align:center;
            width:435px; height:105px;
        }
        .img-default-bg {
            background:url(" static/img/button-bg-lg.png") no-repeat center;
        }
        .img-hover-bg {
            background:url(" static/img/button-bg-lg-hover.png") no-repeat center;
        }

        .row { margin-bottom:8em; }
        .persons{
            border:1px solid #c30f23;
            border-radius:8px;
            width:180px;
            height:60px;
            line-height:60px;
            overflow:hidden;
        }
        .font56{font-size:56px;}
        .primaryExtraction{margin:2em 0; text-align:center;}
    </style>
</head>

<body>


    <div class="wall">

        <!--绝对定位背景大图-->
        <div class="absolute-bg">
            <img src=" static/img/bg.png" alt="">
        </div>
	  <!-- 弹幕 barrage /'bærɑːʒ/ n.弹幕 -->
	    <div class="barrage-container">
	        <!-- first line -- 第1行 -->
	        <div class="line1-wall every-line-wall"></div>
	        <!-- second line -- 第2行 -->
	        <div class="line2-wall every-line-wall"></div>
	        <!-- third line -- 第3行 -->
	        <div class="line3-wall every-line-wall"></div>
	        <!-- fourth line -- 第4行 -->
	        <div class="line4-wall every-line-wall"></div>
	    </div>

        <!--左侧竖排按钮-->
        <div class="side-left">
            <p class="switch-btn switch-btn-default-bg">关</p>
        </div>

        <!--右侧竖排按钮-->
        <div class="side-right">
            <a href="javascript:" onclick="history.go(-1)">
                <p class="md-same-btn back-btn switch-btn-default-bg">返回</p>
            </a>
            <a href=" static/annualMeeting/lotteryIndex.htm">
                <p class="md-same-btn back-home-btn switch-btn-default-bg">主页</p>
            </a>
        </div>

        <h1 class="font-tips">
        	<c:if test="${prize == '8'}">特等奖</c:if>
        	<c:if test="${prize == '1'}">一等奖</c:if>
        	<c:if test="${prize == '2'}">二等奖</c:if>
        	<c:if test="${prize == '3'}">三等奖</c:if>
        	<c:if test="${prize == '4'}">四等奖</c:if>
        	<c:if test="${prize == '5'}">美容券</c:if>
        </h1>

           <p class="primaryExtraction font56">一次抽取
               <input type="text" id="number" style="border:4px solid #c30f23;border-radius:8px; width:180px;height:60px;line-height:60px;overflow:hidden;text-indent:10px;"> 人
           </p>
        <div class="commence" >开始</div>

    </div>


    <script type="text/javascript">

	  	//获取url中的参数
	    function getUrlParam(name) {
	        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
	        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
	        if (r != null) return unescape(r[2]); return null; //返回参数值
	    }
  
	    $(".commence").click(function(){
	    	var prize = getUrlParam("prize");
			var number = $("#number").val();
			var re = /^[0-9]+$/;
			if (number.length==0 || !re.test(number)) {
				alert("请输入正整数");
				return false;
			}
			if(number > ${losingNumber}){
				alert("中奖人数不能大于未中奖人数("+${losingNumber}+")");
				return false;
			}
			
	        window.location.href = "doSetWinNumber.htm?prize="+prize+"&number="+number;
	    })
	
		$("#number").on("keyup",function(){
		    var content=$(this).val();
		    if(content.length!=1&&content!="10"){
		        $(this).val(content.substring(0,1));
		    }
		});
    
        // 元素配置表: 缓存静态html元素
        var eleConfMap = {
	    	// 弹幕
            brgContainer:       getClassName("barrage-container")[0],
            line1Wall:          getClassName("line1-wall")[0],
            line2Wall:          getClassName("line2-wall")[0],
            line3Wall:          getClassName("line3-wall")[0],
            line4Wall:          getClassName("line4-wall")[0],

            // h1
            fontTips:           getClassName("font-tips")[0],

            // 左侧边2个按钮
            $switchBtn:         $(".switch-btn"),
            $numBtn:            $(".num-btn"),
            $mdSameBtn:         $(".md-same-btn"),

            // 中间奖项按钮
            $awardsBtn:         $(".awards-btn")
        };
	 // ajax 配置图
        var ajaxMap = {

            // 按固定间隔时间读取数据
            ajaxGetJson: function () {
                var getJson = null;
                $.ajax({
                    url:'<%=request.getContextPath()%>/annualMeeting/showBarrage.htm',
                    type:'post',
                    async : false, // false/true 同步/异步
                    error:function(){ },
                    success:function(data){
                        if (typeof data === "string") {
                            data = JSON.parse(data);
                        }
                        getJson = data;
                        // console.log(getJson);
                    }
                });
                return getJson;
            }
        };
	


      	
    
        window.onload = function(){

			// 弹幕
            (function () {

                function barrage () {
                    var json = ajaxMap.ajaxGetJson();
                    var i = 0,
                        len = json.length;
                    console.log(len);
                    var fragment;
                    if (len > 0) {

                        // 创建弹幕 div
                        for (; i < len; i++) {
                            if (i % 4 === 1) {
                                // 创建元素
                                fragment  = mainMap.fnCreateEle(i, json[i]);
                                eleConfMap.line1Wall.appendChild(fragment);
                            }
                            if (i % 4 === 2) {
                                // 创建元素
                                fragment  = mainMap.fnCreateEle(i, json[i]);
                                eleConfMap.line2Wall.appendChild(fragment);
                            }
                            if (i % 4 === 3) {
                                // 创建元素
                                fragment  = mainMap.fnCreateEle(i, json[i]);
                                eleConfMap.line3Wall.appendChild(fragment);
                            }
                            if (i % 4 === 0) {
                                // 创建元素
                                fragment  = mainMap.fnCreateEle(i, json[i]);
                                eleConfMap.line4Wall.appendChild(fragment);
                            }
                        }

                        // 滚动弹幕: 第一行:
                        var aLin1DIV = getClassName("barrage-div", eleConfMap.line1Wall);
                        mainMap.fnScroll(600, aLin1DIV);
                        // 滚动弹幕: 第二行
                        var aLin2DIV = getClassName("barrage-div", eleConfMap.line2Wall);
                        mainMap.fnScroll(400, aLin2DIV);
                        // 滚动弹幕: 第三行
                        var aLin3DIV = getClassName("barrage-div", eleConfMap.line3Wall);
                        mainMap.fnScroll(500, aLin3DIV);
                        // 滚动弹幕: 第四行
                        var aLin4DIV = getClassName("barrage-div", eleConfMap.line4Wall);
                        mainMap.fnScroll(200, aLin4DIV);
                    }
                }
                barrage();

                setInterval(function(){
                    barrage();
                }, 10000);

            })();
            sr.reveal(eleConfMap.fontTips, {
                origin:     "top",
                distance:   "100px",
                opacity:    0,
                scale:      1,
                delay:      0,
                easing:     "linear",
                reset:      false,
                mobile:     true,
                duration:   800
            });





            // 左侧弹幕开关按钮click效果
            eleConfMap.$switchBtn.click(function () {
                if($(this).hasClass("switch-btn-default-bg")){
                    $(this).removeClass("switch-btn-default-bg").addClass("switch-btn-bg-hover");
                    $(this).html("开");
                } else {
                    $(this).removeClass("switch-btn-bg-hover").addClass("switch-btn-default-bg");
                    $(this).html("关");
                }
            });

            // 左侧 数字按钮
            eleConfMap.$numBtn.hover(function () {
                if($(this).hasClass("num-btn-default-bg")){
                    $(this).removeClass("num-btn-default-bg").addClass("num-btn-bg-hover");
                } else {
                    $(this).removeClass("num-btn-bg-hover").addClass("num-btn-default-bg");
                }
            });



            // 4个奖项按钮hover效果
            eleConfMap.$awardsBtn.each(function(){
                $(this).hover(
                   function () {
                       if($(this).hasClass("img-default-bg")){
                           $(this).removeClass("img-default-bg").addClass("img-hover-bg");
                       } else {
                           $(this).removeClass("img-hover-bg").addClass("img-default-bg");
                       }
                   }
                )
            });



            // md-same-btn
            eleConfMap.$mdSameBtn.each(function () {
                $(this).hover(function () {
                    if($(this).hasClass("switch-btn-default-bg")){
                        $(this).removeClass("switch-btn-default-bg").addClass("switch-btn-bg-hover");
                    } else {
                        $(this).removeClass("switch-btn-bg-hover").addClass("switch-btn-default-bg");
                    }
                })
            });

        }
    </script>
</body>
</html>
