<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>大展宏图</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">

    <link rel="stylesheet" href="static/css/bootstrap.css">
    <link rel="stylesheet" href="static/css/reset.css">
    <link rel="stylesheet" href="static/css/global.css">
    <link rel="stylesheet" type="text/css" href="static/css/barrage.css">

    <script type="text/javascript" src="static/js/jquery.min.js"></script>
    <script type="text/javascript" src="static/js/scrollreveal/scrollreveal.min.js"></script>
    <script type="text/javascript" src="static/js/global-functions-new.js"></script>
    <script type="text/javascript" src="static/js/barrage.js"></script>
    
    <script type="text/javascript">
        // 加载scrollReveal
        (function () {
            window.sr = ScrollReveal();
        }());
    </script>

    <style type="text/css">
        .wall { position: relative; }

        h1.title {
            text-align: center;
            font-size: 80px;
            margin-top: 8%;
            margin-bottom:1%;
            letter-spacing: 13px;
        }
        .container { width: 78%; }
        .row { margin-top: 1.2em; }
        h5 { font-size: 24px; }

        p.head-portrait {
            width: 85px;
            height: 85px;
            margin: 1em auto;
            overflow: hidden;
            border: 3px solid #c30f23;
            border-radius: 50%;
        }

        p.head-portrait > img {
            width:100%; height:100%;
        }

        /* 左侧 */
        .side-left, .switch-btn { margin-top: 28%; }

        .side-left > .num-btn {
            margin-top: 20px;
            width: 100%;
            height: 72px;
            line-height: 350%;
            font-size: 24px;
            cursor: pointer;
            text-align: center;
        }

        .num-btn-default-bg {
            color: #c30f23;
            background: url("static/img/side-button-bg-sm.png") no-repeat center;
        }

        .num-btn-bg-hover {
            color: #fff;
            background: url("static/img/side-button-bg-sm-hover.png") no-repeat center;
        }

        /* 右侧css --> global.css */
        p.group-btn {
            background:url("static/img/button-bg-sm.png") no-repeat center center;
            width:280px;height:82px;
            background-size:cover;
            line-height:82px;
            text-align:center;
            color:#fff;
            font-size:38px;
            cursor:pointer;
            margin:.2em auto 0;
        }

    </style>
</head>

<body>


<div class="wall">

    <!--绝对定位背景大图-->
    <div class="absolute-bg">
        <img src="static/img/bg.png" alt="">
    </div>
	<!-- 弹幕 barrage /'bærɑːʒ/ n.弹幕 -->
	<div class="barrage-container">
		<!-- first line -- 第1行 -->
		<div class="line1-wall every-line-wall"></div>
		<!-- second line -- 第2行 -->
		<div class="line2-wall every-line-wall"></div>
		<!-- third line -- 第3行 -->
		<div class="line3-wall every-line-wall"></div>
		<!-- fourth line -- 第4行 -->
		<div class="line4-wall every-line-wall"></div>
	</div>
    <!--左侧竖排按钮-->
    <div class="side-left">
        <p class="switch-btn switch-btn-default-bg">关</p>
    </div>

    <!--右侧竖排按钮-->
    <div class="side-right">
        <a href="<%=path%>/annualMeeting/barrageIndex.htm">
            <p class="md-same-btn back-btn switch-btn-default-bg">返回</p>
        </a>
        <a href="<%=path%>/annualMeeting/lotteryIndex.htm">
            <p class="md-same-btn back-home-btn switch-btn-default-bg">主页</p>
        </a>
    </div>


    <!-- 28.88 -->
    <div class="block">
        <h1 class="title dis-none">大展宏图 28.88元</h1>
        <div class="container">
            <div class="row create-ele-wall"></div>

            <div class="row">
                <p class="group-btn" data-index=0>下一组</p>
            </div>
        </div>
    </div>

    <!-- 38.88 -->
    <div class="block dis-none " >
    <!--  <div style="overflow-y:scroll;height: 570px;width:78%;margin:0 auto;"> -->
    		<div style="overflow-y:scroll;height: 590px;margin:12em auto 0 auto;width: 100%;">
		        <h1 class="title dis-none">大展宏图 38.88元</h1>
		        <div class="container" >
		        
		            <div class="row create-ele-wall"></div>
					<h1 class="title dis-none" style="margin-top:.3em;">大展宏图 58.88元</h1>
			        <div class="container" style="width:100%;">
			            <div class="row create-ele-wall"></div>
			
			            
			        </div>
		            <!-- <div class="row">
		                <p class="group-btn" data-index=1>下一组</p>
		            </div> -->
		        </div>
	        </div>
	        
	        <div class="row" style="margin-top:2em;">
	                <p class="group-btn" data-index=1>上一组</p>
	            </div>
        <!-- </div> -->
    </div>

    <!-- 58.88 -->
   <!--  <div class="block dis-none">
       
    </div> -->
</div>


<script type="text/javascript">

    // 元素配置表: 缓存静态html元素
    var eleConfMap = {
		// 弹幕
		brgContainer:       getClassName("barrage-container")[0],
		line1Wall:          getClassName("line1-wall")[0],
		line2Wall:          getClassName("line2-wall")[0],
		line3Wall:          getClassName("line3-wall")[0],
		line4Wall:          getClassName("line4-wall")[0],
        // container-fluid
        createEleWall:      getClassName("create-ele-wall"),

        // h1 - 28.88, 38.88, 58.88 的标题
        title:              getClassName("title"),

        // block - 代表 28.88, 38.88, 58.88 每个板块
        block:              getClassName("block"),

        // 左侧边2个按钮
        $switchBtn:         $(".switch-btn"),
        $numBtn:            $(".num-btn"),
        $mdSameBtn:         $(".md-same-btn"),

        // 中间
        $createEleWall:     $(".create-ele-wall"),
        $groupBtn:          $(".group-btn")
    };

    // 模拟数据
    /* var users = [
        {name: "鲁智深", avatar: "lu-zhi-shen"},
        {name: "吴用", avatar: "wu-yong"},
        {name: "柴进", avatar: "chai-jin"},
        {name: "朱仝", avatar: "zhu-tong"},
        {name: "秦明", avatar: "qin-ming"},
        {name: "林冲", avatar: "lin-chong"},
        {name: "花荣", avatar: "hua-rong"},
        {name: "呼延灼", avatar: "hu-yan-zhuo"},
        {name: "关胜", avatar: "guan-sheng"},
        {name: "公孙胜", avatar: "gong-sun-sheng"},
        {name: "秦明", avatar: "qin-ming"},
        {name: "林冲", avatar: "lin-chong"},
        {name: "朱仝", avatar: "zhu-tong"},
        {name: "秦明", avatar: "qin-ming"},
        {name: "林冲", avatar: "lin-chong"},
        {name: "花荣", avatar: "hua-rong"},
        {name: "鲁智深", avatar: "lu-zhi-shen"},
        {name: "吴用", avatar: "wu-yong"},
        {name: "柴进", avatar: "chai-jin"},
        {name: "关胜", avatar: "guan-sheng"},
        {name: "公孙胜", avatar: "gong-sun-sheng"},
        {name: "鲁智深", avatar: "lu-zhi-shen"},
        {name: "吴用", avatar: "wu-yong"},
        {name: "呼延灼", avatar: "hu-yan-zhuo"},
        {name: "关胜", avatar: "guan-sheng"},
        {name: "公孙胜", avatar: "gong-sun-sheng"},
        {name: "呼延灼", avatar: "hu-yan-zhuo"},
        {name: "关胜", avatar: "guan-sheng"},
        {name: "吴用", avatar: "wu-yong"},
        {name: "柴进", avatar: "chai-jin"}
    ];

    var users2 = [
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"}
    ];

    var users3 = [
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"},
        {name: "Default", avatar: "default-avatar"}
    ];  */
	// ajax 配置图
	var ajaxMap = {
	
		// 按固定间隔时间读取数据
		ajaxGetJson: function () {
			var getJson = null;
			$.ajax({
				url:'<%=request.getContextPath()%>/annualMeeting/showBarrage.htm',
				type:'post',
				async : false, // false/true 同步/异步
				error:function(){ },
				success:function(data){
					if (typeof data === "string") {
						data = JSON.parse(data);
					}
					getJson = data;
					// console.log(getJson);
				}
			});
			return getJson;
		}
	};

    var mainMap = {
        // create 28.88 + 38.88 element
        fnCommonCreate: function (users) {
            var i = 0,
                len = users.length;
            var fragment = document.createDocumentFragment();
            for (; i < len; i++) {
                var createDiv, createP, createImg, createName;

                createDiv = document.createElement("div");
                createDiv.className = "col-lg-1 hidden-lg text-center create-ele-div mar-bot-1";
                createP = document.createElement("p");
                createP.className = "head-portrait";
                createImg = document.createElement("img");
                var userProfile = users[i].userProfile;
	       		if (userProfile == undefined || userProfile == null || userProfile.trim() == "") {
	         		//显示默认头像
	             	createImg.setAttribute("src", "../image/annualMeeting/default-avatar.png");
         		} else {
	             	createImg.setAttribute("src", users[i].userProfile);
	     		}
                createP.appendChild(createImg);
                createName = document.createElement("h5");
                createName.textContent = users[i].realName;
                createDiv.appendChild(createP);
                createDiv.appendChild(createName);
                fragment.appendChild(createDiv);
            }
            return fragment;
        },

        // create 58.88 element
        fnFiftyCreate:  function (users){
            var i = 0,
                len = users.length;
            var fragment = document.createDocumentFragment();
            for (; i < len; i++) {
                var createDiv, createP, createImg, createName;

                 if( i < 0){
                    createDiv = document.createElement("div");
                    createDiv.className = "col-lg-1 hidden-lg text-center create-ele-div mar-bot-1";
                    fragment.appendChild(createDiv);
                } else { 
                    createDiv = document.createElement("div");
                    createDiv.className = "col-lg-1 hidden-lg text-center create-ele-div mar-bot-1";
                    createP = document.createElement("p");
                    createP.className = "head-portrait";
                    createImg = document.createElement("img");
                    var userProfile = users[i].userProfile;
             		if (userProfile == undefined || userProfile == null || userProfile.trim() == "") {
         				//显示默认头像
                		createImg.setAttribute("src", "../image/annualMeeting/default-avatar.png");
                 	} else {
                    	createImg.setAttribute("src", userProfile);
                  	}
                    createP.appendChild(createImg);
                    createName = document.createElement("h5");
                    createName.textContent = users[i].realName;
                    createDiv.appendChild(createP);
                    createDiv.appendChild(createName);
                    fragment.appendChild(createDiv);
             		}
            }
            return fragment;
        },

        fnScrollReveal: function (createEleDiv) {
            var i = 0,
                len = createEleDiv.length;
            for (; i < len; i++) {
                if(hasClass("hidden-lg", createEleDiv[i]) === false){
                    sr.reveal(createEleDiv[i], {
                        origin: "bottom",
                        distance: "80px",
                        opacity: 0,
                        scale: 1,
                        delay: 100 * (i + 1),
                        easing: "ease",
                        reset: true,
                        duration: 600
                    });
                }
            }
        }
    };


    window.onload = function () {
		var users = ${barrageWinList2};
		var users2 = ${barrageWinList3};
		var users3 = ${barrageWinList4};
		
		// 弹幕
		(function () {
		
			function barrage () {
				var json = ajaxMap.ajaxGetJson();
				var i = 0,
					len = json.length;
				console.log(len);
				var fragment;
				if (len > 0) {
		
					// 创建弹幕 div
					for (; i < len; i++) {
						if (i % 4 === 1) {
							// 创建元素
							fragment  = mainMap.fnCreateEle(i, json[i]);
							eleConfMap.line1Wall.appendChild(fragment);
						}
						if (i % 4 === 2) {
							// 创建元素
							fragment  = mainMap.fnCreateEle(i, json[i]);
							eleConfMap.line2Wall.appendChild(fragment);
						}
						if (i % 4 === 3) {
							// 创建元素
							fragment  = mainMap.fnCreateEle(i, json[i]);
							eleConfMap.line3Wall.appendChild(fragment);
						}
						if (i % 4 === 0) {
							// 创建元素
							fragment  = mainMap.fnCreateEle(i, json[i]);
							eleConfMap.line4Wall.appendChild(fragment);
						}
					}
		
					// 滚动弹幕: 第一行:
					var aLin1DIV = getClassName("barrage-div", eleConfMap.line1Wall);
					mainMap.fnScroll(600, aLin1DIV);
					// 滚动弹幕: 第二行
					var aLin2DIV = getClassName("barrage-div", eleConfMap.line2Wall);
					mainMap.fnScroll(400, aLin2DIV);
					// 滚动弹幕: 第三行
					var aLin3DIV = getClassName("barrage-div", eleConfMap.line3Wall);
					mainMap.fnScroll(500, aLin3DIV);
					// 滚动弹幕: 第四行
					var aLin4DIV = getClassName("barrage-div", eleConfMap.line4Wall);
					mainMap.fnScroll(200, aLin4DIV);
				}
			}
			barrage();
		
			setInterval(function(){
				barrage();
			}, 10000);
			
			 // 弹幕开关
			eleConfMap.$switchBtn.click(function () {
				if ( Number(eleConfMap.brgContainer.style.zIndex) === -20) {
					eleConfMap.brgContainer.style.zIndex = "10";
				} else {
					eleConfMap.brgContainer.style.zIndex = "-20";
				}
			})
		
		})();
        // 左侧弹幕开关按钮click效果
        (function () {
            eleConfMap.$switchBtn.click(function () {
                if ($(this).hasClass("switch-btn-default-bg")) {
                    $(this).removeClass("switch-btn-default-bg").addClass("switch-btn-bg-hover");
                    $(this).html("开");
                } else {
                    $(this).removeClass("switch-btn-bg-hover").addClass("switch-btn-default-bg");
                    $(this).html("关");
                }
            });

            // 左侧 数字按钮
            eleConfMap.$numBtn.hover(function () {
                if ($(this).hasClass("num-btn-default-bg")) {
                    $(this).removeClass("num-btn-default-bg").addClass("num-btn-bg-hover");
                } else {
                    $(this).removeClass("num-btn-bg-hover").addClass("num-btn-default-bg");
                }
            });
        })();


        // 右侧 - md-same-btn
        (function () {
            eleConfMap.$mdSameBtn.each(function () {
                $(this).hover(function () {
                    if ($(this).hasClass("switch-btn-default-bg")) {
                        $(this).removeClass("switch-btn-default-bg").addClass("switch-btn-bg-hover");
                    } else {
                        $(this).removeClass("switch-btn-bg-hover").addClass("switch-btn-default-bg");
                    }
                })
            });
        })();


        // 中部 - js
        (function () {

            (function () {
                // 创建 28.88 的中奖者
                eleConfMap.createEleWall[0].appendChild(mainMap.fnCommonCreate(users));
                // 创建模块后，立刻把第一个28.88模块中的create-ele-div上的hidden-lg移除
                var createEleDiv = eleConfMap.block[0].getElementsByClassName("create-ele-div");
                var i = 0,
                    len = createEleDiv.length;
                for (; i < len; i++) {
                    if(hasClass("hidden-lg", createEleDiv[i])){
                        removeClass("hidden-lg", createEleDiv[i]);
                    }
                }
                removeClass("dis-none", eleConfMap.title[0]);
            })();


            // 创建 38.88 的中奖者
            eleConfMap.createEleWall[1].appendChild(mainMap.fnCommonCreate(users2));

            // 58.88
            eleConfMap.createEleWall[2].appendChild(mainMap.fnFiftyCreate(users3));

            // 当创建模块没有 hidden-lg 类名的，添加 scrollReveal 效果
            var i = 0,
                len = eleConfMap.block.length;
            for (; i < len; i++) {
                var createEleDiv = eleConfMap.block[i].getElementsByClassName("create-ele-div");
                if (createEleDiv.length > 0) {
                    if(hasClass("dis-none", eleConfMap.block[i]) === false){
                        mainMap.fnScrollReveal(createEleDiv);
                    }

                }
            }


            // 标题-scrollReveal
            (function () {
                var i = 0,
                    len = eleConfMap.title.length;
                for (; i < len; i++) {
                    if(hasClass("dis-none", eleConfMap.title[i])){
                        removeClass("dis-none", eleConfMap.title[i]);
                        sr.reveal(eleConfMap.title[i], {
                            origin: "top",
                            distance: "100px",
                            opacity: 0,
                            scale: 1,
                            delay: 0,
                            easing: "linear",
                            reset: true,
                            duration: 800
                        });
                    } else {
                        sr.reveal(eleConfMap.title[i], {
                            origin: "top",
                            distance: "100px",
                            opacity: 0,
                            scale: 1,
                            delay: 0,
                            easing: "linear",
                            reset: true,
                            duration: 800
                        });
                    }

                }
            })();


            // 给3个block添加 dis-none
            var addDisNone = function () {
                var i = 0,
                    len = eleConfMap.block.length;
                for(; i < len; i++){
                    if(hasClass(eleConfMap.block[i], "dis-none") === false){
                        addClass("dis-none", eleConfMap.block[i]);
                    }
                }
            };


            var publicRemove = function (index) {
                var createEleDiv = eleConfMap.block[index].getElementsByClassName("create-ele-div");
                if (createEleDiv.length > 0) {
                    var i =0,
                        len = createEleDiv.length;
                    for(; i < len; i++){
                        if (hasClass("hidden-lg", createEleDiv[i])) {
                            removeClass("hidden-lg", createEleDiv[i]);
                        }
                    }
                    mainMap.fnScrollReveal(createEleDiv);
                }
            };

            // 下一组-click
            (function () {
                var i = 0,
                    len = eleConfMap.$groupBtn.length;
                for (; i < len; i++) {
                    EventUtil.addHandler(eleConfMap.$groupBtn[i], "click", function () {
                        addDisNone();
                        if(this.getAttribute("data-index") == 0 ){
                            removeClass("dis-none", eleConfMap.block[1]);
                            publicRemove(1);
                        } else if (this.getAttribute("data-index") == 1) {
                            var str = "下一组";
                            var str2 = "上一组";
                            if(this.innerHTML == str2){
                                this.innerHTML = str2;
                                removeClass("dis-none", eleConfMap.block[0]);
                                publicRemove(0);
                                return;
                            }
                           /*  if(this.innerHTML == str2){
                                this.innerHTML = str;
                                removeClass("dis-none", eleConfMap.block[0]);
                                publicRemove(0);
                                return;
                            } */

                        } else if (this.getAttribute("data-index") == 2) {
                            removeClass("dis-none", eleConfMap.block[1]);
                            publicRemove(1);
                        }
                    })
                }
            })();

        })();

    }

</script>
</body>
</html>