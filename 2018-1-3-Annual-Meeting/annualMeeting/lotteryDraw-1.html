<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>抽奖-开始</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">

    <!--<link rel="stylesheet" type="text/css" href=" static/css/annualMeeting/bootstrap.css">-->
    <link rel="stylesheet" type="text/css" href=" static/css/reset.css">
    <link rel="stylesheet" type="text/css" href=" static/css/global.css">
    <link rel="stylesheet" type="text/css" href=" static/css/commonality.css">
    <link rel="stylesheet" type="text/css" href=" static/css/barrage.css">
    

    <script type="text/javascript" src=" static/js/jquery.min.js"></script>
    <script type="text/javascript" src=" static/js/scrollreveal/scrollreveal.min.js"></script>
    <script type="text/javascript" src=" static/js/global-functions-new.js"></script>
    <script type="text/javascript" src=" static/js/barrage.js"></script>
    
    <script type="text/javascript">
        // 加载scrollReveal
        (function(){
            window.sr = ScrollReveal();
        }());
    </script>

    <style type="text/css">

          .middle-qr-code > img {
            width:350px; height:350px;
            background:#f2dede;
            display:block; margin:55px auto;
        }
        h1 {
            text-align:center; font-size:108px;
            margin-top:9%;
            letter-spacing:13px;
        }
        h3 {  font-size:40px;  text-align:center;  }
        h2 {  font-size:56px;  text-align:center;  }
         .headFrame{
          /*  background:url("static/img/avatar-frame.png") no-repeat center center;*/

            background-size:cover;
            width:260px; height:280px;
            margin:1rem auto;
        }
        .circle{
            border-radius: 50%;
            border:4px solid red;
            overflow: hidden;
            width: 12em;
            height: 12em;
            margin: 2.19em 0 0 2.2em;
        }
        .circleTwo{
            border:4px solid red;
            border-radius: 50%;
            overflow: hidden;
            width: 102px;
            height: 102px;
            margin: 1.2em 0 0 1.22em;
        }
       .headFrameTwo{
        /*   background:url("static/img/avatar-frame.png") no-repeat center center;*/
           background-size:cover;
           width:140px; height:180px;
           margin:1rem .7rem;
       }
        img{height:100%;width:100%;}
        .imgOne{width:1200px;overflow:hidden;margin:1rem auto;}
        .imgTwo{width:330px;overflow:hidden;margin:1rem auto;}
        .imgThree{width:500px;overflow:hidden;margin:1rem auto;}
        .imgFour{width:650px;overflow:hidden;margin:1rem auto;}
        .imgFive{width:820px;overflow:hidden;margin:1rem auto;}
        .imgSix{width:980px;overflow:hidden;margin:1rem auto;}
        .imgSeven{width:1140px;overflow:hidden;margin:1rem auto;}
        .imgEight{width:1300px;overflow:hidden;margin:1rem auto;}
        .imgNine{width:1470px;overflow:hidden;margin:1rem auto;}
        .imgTen{width:1630px;overflow:hidden;margin:1rem auto;}
        .centerWid1630{width:1630px; margin: 0 auto;}

        .imgName{
            font-size:40px;height:44px;line-height:44px;text-align:center;margin-top:.2em;
        }
        .imgName1{
            font-size:32px;height:44px;line-height:44px;text-align:center;margin-top:.2em;
        }
    </style>
</head>

<body>

    <div class="wall">

        <!--绝对定位背景大图-->
        <div class="absolute-bg">
            <img src="static/img/bg.png" alt="">
        </div>
		<!-- 弹幕 barrage /'bærɑːʒ/ n.弹幕 -->
		<div class="barrage-container">
			<!-- first line -- 第1行 -->
			<div class="line1-wall every-line-wall"></div>
			<!-- second line -- 第2行 -->
			<div class="line2-wall every-line-wall"></div>
			<!-- third line -- 第3行 -->
			<div class="line3-wall every-line-wall"></div>
			<!-- fourth line -- 第4行 -->
			<div class="line4-wall every-line-wall"></div>
		</div>
        <!--右侧竖排按钮-->
        <div class="side-right">

            <a href=" static/annualMeeting/lotteryIndex.htm">
                <p class="md-same-btn back-home-btn switch-btn-default-bg" style="height:84px;margin-top:200px;">主页</p>
            </a>
        </div>

        <div class="centerWid1630">
        	<c:if test="${param.prize == '8'}"><h1>特等奖</h1><h2>奖金10000元</h2></c:if>
        	<c:if test="${param.prize == '1'}"><h1>一等奖</h1><h2>奖金2000元</h2></c:if>
        	<c:if test="${param.prize == '2'}"><h1>二等奖</h1><h2>奖金1500元</h2></c:if>
            <c:if test="${param.prize == '3'}"><h1>三等奖</h1><h2>奖金800元</h2></c:if>
            <c:if test="${param.prize == '4'}"><h1>四等奖</h1><h2>奖金500元</h2></c:if>
            <c:if test="${param.prize == '5'}"><h1>美容券</h1><h2>面值980</h2></c:if>

            <%-- <div class="headFrame " style="overflow:hidden;">
                <p  class="circle">
                    <img src=" static/image/annualMeeting/chai-jin.jpg" class="stochasticImg" style="width:100%;height:100%;">
                </p>
            </div> --%>
            
            <div class="imgTen" id="main">
            
            </div>
            <div style="clear:both"></div>
          	 <div style="overflow:hidden;width:40%;margin:0 auto;"> 
                   <p class="commence fl" isclick="0" style="margin:0 20px 0 170px;" >开始 </p> 
                   <span class="fastener" style="display:none;" onclick="javascript:window.location.href='advertisement.jsp'">奖品简介</span> 
               </div>

        </div>

    </div>

    <script type="text/javascript">
    	if(${param.prize }==5){
    		$(".fastener").show();
    	}
    
	  //获取url中的参数
	    function getUrlParam(name) {
	        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
	        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
	        if (r != null) return unescape(r[2]); return null; //返回参数值
	    }
  
	  	var prize = getUrlParam("prize");//奖项 1：一等奖  2：二等奖 3：三等奖 4:四等奖 5：美容券 8:特等奖
	  	var number = getUrlParam("number");//中奖人数
	  	
	    if(number == 1){
	         $("#main").attr("class","imgTen");
	         for(var i =0;i<number;i++){
	             $("#main").append("<div class='headFrame' style='overflow:hidden;'>"+
	                 "<p  class='circle '>"+
	                 "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                 "</p>"+
                     "<p class='imgName tot'>"+
                     "智付钱包"+
                     "</p>"+
	                 "</div>")
	
	         }
	    }
	    if(number == 2){
	        $("#main").attr("class","imgTwo");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 3){
	        $("#main").attr("class","imgThree");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 4){
	        $("#main").attr("class","imgFour");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 5){
	        $("#main").attr("class","imgFive");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 6){
	        $("#main").attr("class","imgSix");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 7){
	        $("#main").attr("class","imgSeven");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 8){
	        $("#main").attr("class","imgEight");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 9){
	        $("#main").attr("class","imgNine");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }
	    if(number == 10){
	        $("#main").attr("class","imgTen");
	        for(var i =0;i<number;i++){
	            $("#main").append("<div class='headFrameTwo fl' style='overflow:hidden;'>"+
	                "<p  class='circleTwo '>"+
	                "<img src=' static/image/annualMeeting/default-avatar.png' class='stochasticImg'>"+
	                "</p>"+
                    "<p class='imgName1 tot'>"+
                    "智付钱包"+
                    "</p>"+
	                "</div>")
	
	        }
	    }


        // 元素配置表: 缓存静态html元素
        var eleConfMap = {
        	// 弹幕
			brgContainer:       getClassName("barrage-container")[0],
			line1Wall:          getClassName("line1-wall")[0],
			line2Wall:          getClassName("line2-wall")[0],
			line3Wall:          getClassName("line3-wall")[0],
			line4Wall:          getClassName("line4-wall")[0],
            // h1
            fontTips:           getClassName("font-tips")[0],

            // 左侧边2个按钮
            $switchBtn:         $(".switch-btn"),
            $numBtn:            $(".num-btn"),
            $mdSameBtn:         $(".md-same-btn"),

            // 中间奖项按钮
            $awardsBtn:         $(".awards-btn")
        };
		// ajax 配置图
		var ajaxMap = {
		
			// 按固定间隔时间读取数据
			ajaxGetJson: function () {
				var getJson = null;
				$.ajax({
					url:'<%=request.getContextPath()%>/annualMeeting/showBarrage.htm',
					type:'post',
					async : false, // false/true 同步/异步
					error:function(){ },
					success:function(data){
						if (typeof data === "string") {
							data = JSON.parse(data);
						}
						getJson = data;
						// console.log(getJson);
					}
				});
				return getJson;
			}
		};
		
        window.onload = function(){
			// 弹幕
			(function () {
			
				function barrage () {
					var json = ajaxMap.ajaxGetJson();
					var i = 0,
						len = json.length;
					console.log(len);
					var fragment;
					if (len > 0) {
			
						// 创建弹幕 div
						for (; i < len; i++) {
							if (i % 4 === 1) {
								// 创建元素
								fragment  = mainMap.fnCreateEle(i, json[i]);
								eleConfMap.line1Wall.appendChild(fragment);
							}
							if (i % 4 === 2) {
								// 创建元素
								fragment  = mainMap.fnCreateEle(i, json[i]);
								eleConfMap.line2Wall.appendChild(fragment);
							}
							if (i % 4 === 3) {
								// 创建元素
								fragment  = mainMap.fnCreateEle(i, json[i]);
								eleConfMap.line3Wall.appendChild(fragment);
							}
							if (i % 4 === 0) {
								// 创建元素
								fragment  = mainMap.fnCreateEle(i, json[i]);
								eleConfMap.line4Wall.appendChild(fragment);
							}
						}
			
						// 滚动弹幕: 第一行:
						var aLin1DIV = getClassName("barrage-div", eleConfMap.line1Wall);
						mainMap.fnScroll(600, aLin1DIV);
						// 滚动弹幕: 第二行
						var aLin2DIV = getClassName("barrage-div", eleConfMap.line2Wall);
						mainMap.fnScroll(400, aLin2DIV);
						// 滚动弹幕: 第三行
						var aLin3DIV = getClassName("barrage-div", eleConfMap.line3Wall);
						mainMap.fnScroll(500, aLin3DIV);
						// 滚动弹幕: 第四行
						var aLin4DIV = getClassName("barrage-div", eleConfMap.line4Wall);
						mainMap.fnScroll(200, aLin4DIV);
					}
				}
				barrage();
			
				setInterval(function(){
					barrage();
				}, 10000);
				
				 // 弹幕开关
				eleConfMap.$switchBtn.click(function () {
					if ( Number(eleConfMap.brgContainer.style.zIndex) === -20) {
						eleConfMap.brgContainer.style.zIndex = "10";
					} else {
						eleConfMap.brgContainer.style.zIndex = "-20";
					}
				})
			
			})();
            sr.reveal(eleConfMap.fontTips, {
                origin:     "top",
                distance:   "100px",
                opacity:    0,
                scale:      1,
                delay:      0,
                easing:     "linear",
                reset:      false,
                mobile:     true,
                duration:   800
            });

            // 左侧 数字按钮
            eleConfMap.$numBtn.hover(function () {
                if($(this).hasClass("num-btn-default-bg")){
                    $(this).removeClass("num-btn-default-bg").addClass("num-btn-bg-hover");
                } else {
                    $(this).removeClass("num-btn-bg-hover").addClass("num-btn-default-bg");
                }
            });

            // md-same-btn
            eleConfMap.$mdSameBtn.each(function () {
                $(this).hover(function () {
                    if($(this).hasClass("switch-btn-default-bg")){
                        $(this).removeClass("switch-btn-default-bg").addClass("switch-btn-bg-hover");
                    } else {
                        $(this).removeClass("switch-btn-bg-hover").addClass("switch-btn-default-bg");
                    }
                })
            });
        }

        var realName;
        var userProfile;
    		
        $.ajax({
	    	url:' static/annualMeeting/getPreviewProfile.htm?prize='+prize,
			type : 'post',
			async : false, //默认为true 异步   
			error : function() {
				/* alert('error'); */
			},
			success : function(data) {
				var previewJson = JSON.parse(data);
				realName = new Array([previewJson.length]);
				userProfile =  new Array([previewJson.length]);
				for(var i=0;i<previewJson.length;i++){
					realName[i] = previewJson[i].realName;
					userProfile[i] = previewJson[i].userProfile;
				}
				
				 /* $(".tot").each(function(){ 
		                for(var i =0;i<userProfile.length;i++){ 
		                 //  $(this).prev().find("img").attr("src",userProfile[i]);
		                 //   $(this).text(realName[i]); 
		                } 

		            }) */
			}
		});
        
        function stochastic(curImg,curNmae){
        	var radom = parseInt(Math.random()*(userProfile.length));
            var a = userProfile[radom];
            var b = realName[radom]
         //   console.log(parseInt(Math.random()*(userProfile.length)))
            /* document.write("<img src="+a+">");*/
            curImg.setAttribute("src",a);
            curNmae.innerHTML=b;
        }
   
        var fr; 
        if(localStorage.getItem("time")==1){
            $(".commence").html("停止").attr("isclick",1);
            var i=0,
                ele = document.getElementsByClassName("stochasticImg"),
                ele1 = document.getElementsByClassName("tot"),
                len = ele.length;
            for(; i < len; i++) {
                ele[i] = function (num) {
                    console.log(ele[num])
                    fr= setInterval(function(){
                        stochastic(ele[num],ele1[num])
                    } ,200 + (i*10 +50));
                }(i);
            }
        }
        $(".commence").click(function(){

            if($(this).attr("isclick")==0){
                $(this).html("停止").attr("isclick",1);
                var i=0,
                    ele = document.getElementsByClassName("stochasticImg"),
                    ele1 = document.getElementsByClassName("tot"),
                    len = ele.length;
                for(; i < len; i++) {
                    ele[i] = function (num) {
                        console.log(ele[num])
                        fr= setInterval(function(){
                                stochastic(ele[num],ele1[num])
                        } ,200 + (i*10 +50));
                    }(i);
                }
             }else{ 
                 
                 if(prize == '8'){//特等奖
                	 if(localStorage.getItem("time")== null){ 
                         if(localStorage.getItem("time") == "" || localStorage.getItem("time") == null){ 
                             localStorage.setItem("time", 0) 
                             console.log(localStorage.getItem("time")); 
                         } 
                         window.setTimeout(" window.location.href='lotteryDraw-2.jsp?prize='+prize+'&number='+number", 1000); 
                         return; 
                     } 
                     if(localStorage.getItem("time")==0){ 
                         if(localStorage.getItem("time") == 0){ 
                             localStorage.setItem("time", 1) 
                             console.log(localStorage.getItem("time")); 
                         } 
                         window.setTimeout(" window.location.href='lotteryDraw-3.jsp?prize='+prize+'&number='+number", 1000); 
                         return; 
                     } 
                     if(localStorage.getItem("time")==1){ 
                         localStorage.removeItem("time");
                         window.setTimeout(" window.location.href='getTheWinners.htm'", 1000); 
                     }
                 }else{//一二三四等奖
                	 localStorage.removeItem("time");
                	 window.setTimeout(" window.location.href='getTheWinners.htm'", 1000);
                 }
                  
             } 
         }); 
     </script>
</body>
</html>
