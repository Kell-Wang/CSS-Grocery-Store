<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; Charset=utf-8">
    <title>图片延时加载</title>
    <style type="text/css">
        *{margin:0; padding:0; list-style:none; font:normal 14px Arial;}
        .head{
            width:90%; height:220px;
            margin:10px auto 200px; overflow:hidden;
            background: lightcoral;
            border-radius: 5px;
            text-align: center;
        }
        .head .headFont{
            font:32px "Microsoft YaHei";
            line-height:32px;
            margin-top:85px;
        }
        .main{
            width:90%;
            margin:20px auto;
            overflow:hidden;
        }
        #wall span{
            width: 30%;
            height: 400px;
            margin-left: 1.5%;
            margin-right: 1.5%;
            margin-bottom:30px;
            float: left;
            border-radius: 10px;
            overflow: hidden;
        }
        #wall span > img { width: auto; height: 100%; }
    </style>

</head>

<body>
<div class="head">
    <p class="headFont">图片延时加载</p>
</div>

<div class="main">
    <div id="wall">
        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>

        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>

        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>

        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>

        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>

        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>

        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>

        <span><img src="img/lazyImg.png"></span>
        <span class="centerSpanStyle"><img src="img/lazyImg.png"></span>
        <span><img src="img/lazyImg.png"></span>
    </div>
</div>


<script type="text/javascript">
    var imgs = [
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png",
        "img/img1.png"];
    var EventUtil = {
        addHandler: function(element, type, handler){
            if(element.addEventListener){
                element.addEventListener(type, handler,false);
            }else if(element.attachEvent){
                element.attachEvent("on"+type, handler);
            }else{
                element["on" + type] = handler;
            }
        },
        getEvent: function(event){
            return event ? event : window.event;
        },
        getTarget: function(event){
            return event.target || event.srcElement;
        },
        preventDefault: function(event){
            if(event.preventDefault){
                return event.preventDefault();
            }else{
                return event.returnValue = false;
            }
        },
        stopPropagation: function(event){
            if(event.stopPropagation){
                event.stopPropagation();
            }else{
                event.cancelBubble = true;
            }
        }
    };

    //获取经过计算的css样式
    function getCss(element,attr){
        if(window.getComputedStyle){
            return window.getComputedStyle(element, false)[attr];
        }else{
            return element.currentStyle[attr];
        }
    }

    //获取当前元素在浏览器中的位置(就是元素的偏移量)，根元素应该为 body 元素。
    function getPosition(element){
        var actualLeft = element.offsetLeft;
        var actualTop = element.offsetTop;
        var currentParent = element.offsetParent;
        // console.log("currentParent.tagName: ", currentParent.tagName);   // BODY
        while(currentParent != null){
            actualLeft += currentParent.offsetLeft;
            actualTop += currentParent.offsetTop;
            currentParent = currentParent.offsetParent;
        }
        return {x: actualLeft, y: actualTop };
    }


    function lazyImage(){
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        console.log("document.documentElement.scrollTop: ", scrollTop);
        var clientTop = document.documentElement.clientHeight || document.body.clientHeight;
        console.log("document.documentElement.clientHeight: ", clientTop);

        var images = document.getElementById("wall").getElementsByTagName("img");
        for(var i=0; i<images.length;i++){
            console.log("current img index: ", i);
            // 元素的垂直偏移量都是根据元素的左上角来定位的
            console.log("current img actualTop: ", getPosition(images[i]).y);
            if(getPosition(images[i]).y + parseInt(getCss(images[i], "height")) < (scrollTop + clientTop)){
                images[i].src = imgs[i];
            }
        }
    }
    window.onload = function(){
        EventUtil.addHandler(window, "scroll", function(){
            lazyImage();
        });
    }
</script>

</body>
</html>
